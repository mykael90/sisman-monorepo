// This file is reserved for Prisma models related to SIPAC (Sistema Integrado de Patrimônio, Administração e Contratos) integration.
// Models defined here will handle data structures specific to SIPAC, if and when integration is implemented.

// Represents material data from SIPAC.
model SipacMaterial {
    idMaterial               Int      @id // Identificador do material.
    ativo                    Boolean // Indica se o material está ativo.
    codigo                   String   @unique // Código do material.
    codigoSidec              String? // Código do material no sistema do governo SIDEC.
    consumoEnergia           Decimal? @db.Decimal(12, 4) // Consumo de energia.
    dataUltimaCompra         DateTime @db.Timestamp(0) // Data da última compra do material (timestamp).
    denominacaoGrupo         String? // Denominação do grupo do material.
    denominacaoMaterial      String // Denominação do material.
    denominacaoMaterialAscii String? // Denominação do material em ASCII.
    denominacaoSubGrupo      String? // Denominação do sub-grupo do material.
    denominacaoUnidade       String? // Denominação da unidade do material.
    especificacao            String? // Especificação do material.
    especificacaoAscii       String? // Especificação do material em ASCII.
    idGrupo                  Int? // Identificador do grupo do material.
    idSubGrupo               Int? // Identificador do sub-grupo do material.
    precoCompra              Decimal? @db.Decimal(12, 4) // Preço de compra do material.
    valorEstimado            Decimal? @db.Decimal(12, 4) // Valor estimado do material.

    createdAt DateTime @default(now()) @db.Timestamp(0)
    updatedAt DateTime @updatedAt @db.Timestamp(0)

    //Relations
    grupo               SipacGrupoMaterial?           @relation(fields: [idGrupo], references: [idGrupoMaterial])
    subGrupo            SipacSubGrupoMaterial?        @relation(fields: [idSubGrupo], references: [idSubGrupoMaterial])
    requisicoesMaterial SipacItemRequisicaoMaterial[]

    @@index([codigo])
    @@index([idGrupo])
    @@map("sipac_materiais")
}

// Representa um grupo de material do sistema.
model SipacGrupoMaterial {
    idGrupoMaterial   Int     @id // Identificador do grupo.
    ativo             Boolean // Indica se um grupo material está ativo ou não.
    codigo            BigInt  @unique // Código do grupo.
    denominacao       String // Nome do grupo.
    descricao         String? // Descrição detalhada do grupo de material.
    idElementoDespesa Int? // Identificador do elemento de despesa associado ao grupo de material.

    createdAt                DateTime                  @default(now()) @db.Timestamp(0)
    updatedAt                DateTime                  @updatedAt @db.Timestamp(0)
    sipacMateriais           SipacMaterial[]
    subGrupos                SipacSubGrupoMaterial[]
    sipacRequisicoesMaterial SipacRequisicaoMaterial[]

    @@index([codigo])
    @@map("sipac_grupos_materiais")
}

// Representa um sub-grupo de material do sistema.
model SipacSubGrupoMaterial {
    idSubGrupoMaterial Int    @id // Identificador do subgrupo.
    codigo             BigInt @unique // Código identificador do subgrupo. Junção do código do grupo mais um sequencial.
    denominacao        String // Descrição resumida do subgrupo.
    idGrupoMaterial    Int // Identificador do grupo.

    createdAt          DateTime            @default(now()) @db.Timestamp(0)
    updatedAt          DateTime            @updatedAt @db.Timestamp(0)
    sipacMateriais     SipacMaterial[]
    SipacGrupoMaterial SipacGrupoMaterial? @relation(fields: [idGrupoMaterial], references: [idGrupoMaterial])

    @@index([codigo])
    @@index([idGrupoMaterial])
    @@map("sipac_sub_grupos_materiais")
}

// Representa os dados de uma requisição de material do SIPAC.
model SipacRequisicaoMaterial {
    id                            Int       @id // Identificador único da requisição.
    numeroDaRequisicao            String    @unique // Número da requisição no SIPAC (ex: "10990/2025").
    tipoDaRequisicao              String? // Tipo da requisição (ex: "REQUISIÇÃO DE MATERIAL").
    tipoId                        Int? // Identificador do tipo de requisição.
    convenio                      String? // Indica se há convênio (ex: "Não").
    grupoDeMaterial               String? // Grupo de material (ex: "(0)").
    grupoMaterialId               Int? // Identificador do grupo de material.
    unidadeDeCusto                String // Unidade de custo (ex: "INSTITUTO METROPOLE DIGITAL (11.00.05)").
    unidadeRequisitante           String // Unidade requisitante (ex: "DIRETORIA DE MANUTENÇÃO DE INSTALAÇÕES FÍSICAS (11.08.05)").
    destinoDaRequisicao           String? // Destino da requisição (ex: "SUSTENTAÇÃO DE ESTOQUE DO ALMOXARIFADO DA SUP. INFRAESTRUTURA (11.89)").
    usuarioLogin                  String // Usuário que cadastrou a requisição (ex: "edivan.nascimento - EDIVAN DO NASCIMENTO (Ramal: )").
    usuarioId                     Int? // Identificador do usuário que cadastrou a requisição.
    dataDeCadastro                DateTime  @db.Timestamp(0) // Data de cadastro da requisição.
    dataDeEnvio                   DateTime? @db.Timestamp(0) // Data de envio da requisição.
    valorDaRequisicao             Decimal   @db.Decimal(12, 2) // Valor total da requisição.
    valorDoTotalAtendido          Decimal?  @db.Decimal(12, 2) // Valor total atendido da requisição.
    opcaoOrcamentaria             String? // Opção orçamentária (ex: "SOLICITAR AUTORIZAÇÃO ORÇAMENTÁRIA").
    numeroDaRequisicaoRelacionada String? // Número da requisição relacionada (ex: "1164/ 2025 (REQUISIÇÃO DE MANUTENÇÃO)").
    local                         String? // Local da requisição (ex: "INSTITUTO METROPOLE DIGITAL - CIVT").
    observacoes                   String?   @db.Text // Observações gerais da requisição.
    statusAtual                   String // Status atual da requisição (ex: "FINALIZADA").
    almoxarifado                  String // Identificação do almoxarifado
    almoxarifadoId                Int?

    createdAt DateTime @default(now()) @db.Timestamp(0)
    updatedAt DateTime @updatedAt @db.Timestamp(0)

    // Relations
    itensDaRequisicao                          SipacItemRequisicaoMaterial[]
    historicoDaRequisicao                      SipacHistoricoRequisicaoMaterial[]
    totalizacaoPorElementoDeDespesasDetalhados SipacTotalizacaoElementoDespesaMaterial[]
    detalhesDaAquisicao                        SipacDetalheAquisicaoItemMaterial[]
    grupoMaterial                              SipacGrupoMaterial?                       @relation(fields: [grupoMaterialId], references: [idGrupoMaterial])

    // Relation to SipacRequisicaoManutencao
    sipacRequisicaoManutencaoId Int?
    sipacRequisicaoManutencao   SipacRequisicaoManutencao? @relation(fields: [sipacRequisicaoManutencaoId], references: [id], onDelete: SetNull)

    @@index([numeroDaRequisicao])
    @@index([sipacRequisicaoManutencaoId])
    @@map("sipac_requisicoes_materiais")
}

// Representa um item de uma requisição de material do SIPAC.
model SipacItemRequisicaoMaterial {
    id                  Int      @id @default(autoincrement()) // Identificador único do item.
    numeroItem          Int // Número sequencial do item na requisição.
    codigo              String // Código do material.
    quantidade          Int // Quantidade solicitada.
    valor               Decimal  @db.Decimal(12, 2) // Valor unitário do item.
    total               Decimal  @db.Decimal(12, 2) // Valor total do item (quantidade * valor).
    quantidadeAtendida  Int // Quantidade atendida do item.
    quantidadeDevolvida Int // Quantidade devolvida do item.
    quantidadeEmCompra  Int // Quantidade em processo de compra.
    valorAtendimento    Decimal? @db.Decimal(12, 2) // Valor unitário do atendimento.
    totalAtendimento    Decimal? @db.Decimal(12, 2) // Valor total do atendimento.
    status              String // Status do item (ex: "ATENDIDO").

    requisicaoId Int? // Chave estrangeira para SipacRequisicaoMaterial.
    requisicao   SipacRequisicaoMaterial? @relation(fields: [requisicaoId], references: [id], onDelete: Cascade)

    material SipacMaterial @relation(fields: [codigo], references: [codigo])

    createdAt DateTime @default(now()) @db.Timestamp(0)
    updatedAt DateTime @updatedAt @db.Timestamp(0)

    @@index([requisicaoId])
    @@map("sipac_itens_requisicao_material")
}

// Representa uma entrada no histórico de uma requisição de material do SIPAC.
model SipacHistoricoRequisicaoMaterial {
    id          Int      @id @default(autoincrement()) // Identificador único da entrada de histórico.
    dataHora    DateTime @db.Timestamp(0) // Data e hora do evento.
    status      String // Status atribuído no evento (ex: "CADASTRADA", "AUTORIZADA").
    usuario     String // Usuário responsável pelo evento.
    observacoes String?  @db.Text // Observações do evento.

    requisicaoId Int // Chave estrangeira para SipacRequisicaoMaterial.
    requisicao   SipacRequisicaoMaterial @relation(fields: [requisicaoId], references: [id], onDelete: Cascade)

    createdAt DateTime @default(now()) @db.Timestamp(0)
    updatedAt DateTime @updatedAt @db.Timestamp(0)

    @@index([requisicaoId])
    @@map("sipac_historico_requisicao_material")
}

// Representa a totalização por elemento de despesa de uma requisição de material.
model SipacTotalizacaoElementoDespesaMaterial {
    id              Int     @id @default(autoincrement()) // Identificador único.
    grupoDeMaterial String // Descrição do grupo de material e elemento de despesa.
    total           Decimal @db.Decimal(12, 2) // Valor total para o grupo.

    requisicaoId Int? // Chave estrangeira para SipacRequisicaoMaterial.
    requisicao   SipacRequisicaoMaterial? @relation(fields: [requisicaoId], references: [id], onDelete: Cascade)

    createdAt DateTime @default(now()) @db.Timestamp(0)
    updatedAt DateTime @updatedAt @db.Timestamp(0)

    @@index([requisicaoId])
    @@map("sipac_totalizacao_elemento_despesa_material")
}

// Representa os detalhes da aquisição dos itens de uma requisição.
model SipacDetalheAquisicaoItemMaterial {
    id                   Int     @id @default(autoincrement()) // Identificador único.
    compras              String? // Informações sobre processos de compra.
    empenhos             String? // Informações sobre empenhos.
    notasFiscais         String? // Informações sobre notas fiscais.
    processosDePagamento String? // Informações sobre processos de pagamento.

    requisicaoId Int // Chave estrangeira para SipacRequisicaoMaterial.
    requisicao   SipacRequisicaoMaterial @relation(fields: [requisicaoId], references: [id], onDelete: Cascade)

    createdAt DateTime @default(now()) @db.Timestamp(0)
    updatedAt DateTime @updatedAt @db.Timestamp(0)

    @@index([requisicaoId])
    @@map("sipac_detalhe_aquisicao_item_material")
}

// Representa uma requisição de manutenção do SIPAC.
model SipacRequisicaoManutencao {
    id                             Int       @id // Identificador único da requisição de manutenção.
    numeroRequisicao               String    @unique // Número da requisição (ex: "2124/2025").
    categoriaRequisicao            String? // Categoria da requisição (ex: "Manutenção Corretiva"; "Manutenção Preventiva"; "Meio Ambiente").
    idCategoria                    Int?
    tipoDaRequisicao               String? // Tipo da requisição (ex: "REQUISIÇÃO DE MANUTENÇÃO").
    idTipo                         Int? // Identificador do tipo da requisição.
    divisao                        String? // Divisão (ex: "Serviços Gerais").
    usuarioGravacao                String // Usuário que gravou a requisição (ex: "JOAO PAULO FELIPE PINTO").
    idUsuarioGravacao              Int? // Identificador do usuário que gravou a requisição.
    status                         String // Status da requisição (ex: "PEDIDO DE MATERIAL REALIZADO").
    dataDeCadastro                 DateTime? @db.Timestamp(0) // Data de cadastro da requisição.
    nomeUnidadeRequisitante        String? // Unidade requisitante.
    nomeUnidadeDeCusto             String? // Unidade de custo.
    nomePredio                     String? // Nome do prédio.
    descricao                      String    @db.Text // Descrição da requisição.
    local                          String? // Local da requisição.
    representanteDaUnidadeDeOrigem String?
    telefonesDoRepresentante       String?
    ramal                          String?
    email                          String?
    horarioParaAtendimento         String?
    observacao                     String?   @db.Text

    createdAt DateTime @default(now()) @db.Timestamp(0)
    updatedAt DateTime @updatedAt @db.Timestamp(0)

    // Relations
    informacoesServico          SipacInformacaoServicoManutencao[]
    requisicaoManutencaoIdMae   Int?
    // Requisições de manutenção que esta requisição lista como associadas
    requisicaoManutencaoMae     SipacRequisicaoManutencao?         @relation("RequisicaoManutencaoAssociacao", fields: [requisicaoManutencaoIdMae], references: [id])
    // Requisições de manutenção que listam esta requisição como associada
    requisicoesManutencaoFilhas SipacRequisicaoManutencao[]        @relation("RequisicaoManutencaoAssociacao")
    requisicoesMateriais        SipacRequisicaoMaterial[] // Requisições de material vinculadas a esta requisição de manutenção
    predios                     SipacPredio[]
    historico                   SipacHistoricoManutencao[]

    //unidades
    unidadeRequisitanteId Int?
    unidadeRequisitante   SipacUnidade? @relation("unidadeRequisitante", fields: [unidadeRequisitanteId], references: [id])
    unidadeCustoId        Int?
    unidadeCusto          SipacUnidade? @relation("unidadeCusto", fields: [unidadeCustoId], references: [id])

    @@index([numeroRequisicao])
    @@map("sipac_requisicoes_manutencao")
}

// Representa informações do serviço de uma requisição de manutenção.
model SipacInformacaoServicoManutencao {
    id                 Int      @id @default(autoincrement())
    diagnostico        String?
    executante         String?
    dataDeCadastro     DateTime @db.Timestamp(0)
    tecnicoResponsavel String?

    requisicaoManutencaoId Int
    requisicaoManutencao   SipacRequisicaoManutencao @relation(fields: [requisicaoManutencaoId], references: [id], onDelete: Cascade)

    @@index([requisicaoManutencaoId])
    @@map("sipac_informacoes_servico_manutencao")
}

// Representa o histórico de uma requisição de manutenção.
model SipacHistoricoManutencao {
    id          Int      @id @default(autoincrement())
    data        DateTime @db.Timestamp(0) // Data do evento no histórico.
    status      String // Status atribuído no evento.
    usuario     String // Usuário responsável pelo evento.
    ramal       String? // Ramal do usuário.
    observacoes String?  @db.Text // Observações do evento.

    requisicaoManutencaoId Int
    requisicaoManutencao   SipacRequisicaoManutencao @relation(fields: [requisicaoManutencaoId], references: [id], onDelete: Cascade)

    @@index([requisicaoManutencaoId])
    @@map("sipac_historico_manutencao")
}

// Representa um imóvel no sistema SIPAC.
model SipacImovel {
    rip        String   @id /// Corresponde ao registro do imóvel no SPIUnet, sistema do governo.
    nomeImovel String /// Nome do imóvel. Tive que retirar a restrição unique pois tem nome repetido
    latitude   Decimal? @db.Decimal(8, 6) /// Latitude do prédio.
    longitude  Decimal? @db.Decimal(9, 6) /// Longitude do prédio.

    tipoVocacao String?

    tipoFormaAquisicao String?

    tipoImovel String?

    // Relations
    predios  SipacPredio[]
    endereco SipacImovelEndereco?
    campus   SipacCampus?

    @@index([rip])
    @@map("sipac_imoveis")
}

model SipacImovelEndereco {
    id          Int     @id() @default(autoincrement())
    municipio   String /// Município ao qual o imóvel pertence. TODO: Relacionar com SipacMunicipio se existir.
    bairro      String? /// Bairro ao qual o imóvel pertence. TODO: Relacionar com SipacBairro se existir.
    logradouro  String? /// Logradouro ao qual o imóvel pertence. TODO: Relacionar com SipacLogradouro se existir.
    numero      String? /// Número do imóvel.
    complemento String? /// Complemento do imóvel.
    cep         String? /// CEP do imóvel.

    ripImovel String      @unique /// Identificador do imóvel associado ao endereço.
    imovel    SipacImovel @relation(fields: [ripImovel], references: [rip])

    @@index([ripImovel])
    @@map("sipac_imoveis_enderecos")
}

model SipacCampus {
    id         Int          @id @default(autoincrement())
    nomeCampus String       @unique
    ripImovel  String?      @unique /// Identificador do imóvel associado ao endereço.
    imovel     SipacImovel? @relation(fields: [ripImovel], references: [rip])

    @@index([ripImovel])
    @@index([nomeCampus])
    @@map("sipac_campus")
}

// Representa um prédio associado a um imóvel no sistema SIPAC.
model SipacPredio {
    subRip            String   @id /// Sub Rip do prédio
    denominacaoPredio String   @db.VarChar(500) /// Denominação do prédio
    idZona            String? /// Identificador da zona associada ao prédio. TODO: Relacionar com SipacZona se existir.
    ripImovel         String /// Identificador do imóvel associado ao prédio
    latitude          Decimal? @db.Decimal(8, 6) /// Latitude do prédio.
    longitude         Decimal? @db.Decimal(9, 6) /// Longitude do prédio.

    imovel SipacImovel @relation(fields: [ripImovel], references: [rip])

    requisicoesManutencao SipacRequisicaoManutencao[]

    @@index([ripImovel])
    @@map("sipac_predios")
}

// Representa uma unidade da instituição.
model SipacUnidade {
    id            Int     @id // Identificador da unidade.
    codigoUnidade String  @unique // Código da unidade.
    nomeUnidade   String // Nome da unidade.
    sigla         String? // Sigla da unidade.

    requisicoesManutencaoRequisistante SipacRequisicaoManutencao[] @relation("unidadeRequisitante")
    requisicoesManutencaoCusto         SipacRequisicaoManutencao[] @relation("unidadeCusto")

    @@index([codigoUnidade])
    @@index([nomeUnidade])
    @@index([sigla])
    @@map("sipac_unidades")
}

// Defines the possible statuses for a MaterialRequest.
enum SipacRequisicaoManutencaoStatus {
    AGUARDANDO_AVALIACAO_REQUISITANTE
    AGUARDANDO_PEDIDO_MATERIAL
    AGUARDANDO_VISITA
    AUTORIZADA
    CADASTRADA
    EM_ROTA_VISITA
    EM_EXECUCAO
    ENVIADA
    ESTORNADA
    FINALIZADA
    MATERIAL_RECEBIDO
    NEGADA
    PEDIDO_MATERIAL_REALIZADO
    RETORNADA
    SERVICO_AVALIADO
    SERVICO_NAO_EXECUTADO
}

enum SipacRequisicaoManutencaoDivisoes {
    AR_CONDICIONADO
    INSTALACOES_ELETRICAS_E_TELECOMUNICACOES
    INSTALACOES_HIDRAULICAS_E_SANITARIAS
    OUTROS
    SERVICOS_GERAIS
    VIARIO
}
